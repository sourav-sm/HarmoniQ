import { NextRequest, NextResponse } from "next/server";
import {z} from "zod";
import { prismaClient } from "@/app/lib/db";
//var YT_REGEX=new RegExp("^http:\/\/www\.youtube\.com\/watch\?v={11}$")
var YT_REGEX = /^(?:(?:https?:)?\/\/)?(?:www\.)?(?:m\.)?(?:youtu(?:be)?\.com\/(?:v\/|embed\/|watch(?:\/|\?v=))|youtu\.be\/)((?:\w|-){11})(?:\S+)?$/;

//@ts-ignore
import youtubeSearchApi from "youtube-search-api";

const CreateStreamSchema=z.object({
    creatorId:z.string(),
    url:z.string()
})


export async function POST(req:NextRequest) {
    try{
        const data=CreateStreamSchema.parse(await req.json());
        const isYT=data.url.match(YT_REGEX);
        if(!isYT){
            return NextResponse.json({
                message:"Wrong URL fromat"
            },{
                status:411
            })
        }

        const extractedId=data.url.split("?v=")[1];
        
        const res=await youtubeSearchApi.GetVideoDetails(extractedId)
        // console.log(res);
        const thumbnails=res.thumbnail.thumbnails;
        thumbnails.sort((a:{width:number},b:{width:number})=>a.width<b.width ? -1 : 1);

        const stream=await prismaClient.stream.create({
           data:{
            userId: data.creatorId,
            url:data.url,
            extractedId,
            type:"Youtube",
            title:res.title ?? "Can't find video",
            smallImg:thumbnails.length>1?thumbnails[thumbnails.length-2].url:thumbnails[thumbnails.length-1].url ?? "data:image/jpeg;base64,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",
            bigImg:thumbnails[thumbnails.length-1].url ?? "data:image/jpeg;base64,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",
           }
        })

        return NextResponse.json({
            message:"Added Stream",
            id:stream.id
        })
    }catch(e){
        return NextResponse.json({
            message:"Error while adding a stream",
            e
        },{
            status:411
        })
        
    }
}

export async function GET(req:NextRequest){
    const creatorId=req.nextUrl.searchParams.get("creatorId");
    const streams=await prismaClient.stream.findMany({
        where:{
            userId:creatorId ?? ""
        }
    })

    return NextResponse.json({
        streams
    })
}
